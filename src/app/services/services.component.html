<!-- Fort Story Page (Dark + Gold Theme) -->
<div class="container-fluid bg-dark text-light py-5">
  
  <!-- Dropdown Navigation -->
  <div class="text-center mb-4">
    <label for="fort-nav" class="me-2 text-warning fw-bold">ğŸ° Jump to Fort:</label>
    <select id="fort-nav" class="p-2 rounded bg-secondary text-light border border-warning"
            onchange="if(this.value) window.location.hash=this.value;">
      <option value="">-- Select Fort --</option>
      <option *ngFor="let fort of forts" [value]="'#' + fort.id">{{fort.name}}</option>
    </select>
  </div>

  <div class="row justify-content-center">
    <main class="col-md-11">

      <!-- Dynamic Fort Blocks -->
      <article *ngFor="let fort of forts" [id]="fort.id" class="row story-block bg-secondary p-4 rounded shadow-lg mb-5 align-items-center">
        <div class="col-md-6 mb-3 mb-md-0">
          <h2 class="text-warning"><b>{{fort.name}}</b></h2>
          <p>{{fort.description}}</p>
          <div class="bg-dark p-3 rounded shadow-sm mt-3">
            <p><strong>ğŸ— Built:</strong> {{fort.built}}</p>
            <p><strong>ğŸ“ Address:</strong> {{fort.address}}</p>
            <p *ngIf="fort.phone"><strong>ğŸ“ Phone:</strong> <a [href]="'tel:' + fort.phone" class="text-warning">{{fort.phone}}</a></p>
            <p><strong>ğŸ•’ Hours:</strong> <span class="text-success">{{fort.hours}}</span></p>
          </div>
          
          <!-- Action Buttons -->
          <div class="mt-3">
            <button class="btn btn-warning me-2" (click)="toggleMap(fort.id)">
              {{showMap[fort.id] ? 'Hide Map' : 'Show Map'}} ğŸ—ºï¸
            </button>
            <button class="btn btn-info me-2" (click)="toggleGuideAssignment(fort.id)">
              {{showGuideAssignment[fort.id] ? 'Hide Guides' : 'Assign Guide'}} ğŸ‘¨ğŸ«
            </button>
          </div>

          <!-- Assigned Guide Info -->
          <div *ngIf="getAssignedGuide(fort.id)" class="mt-3 p-2 bg-success rounded">
            <strong>ğŸ¯ Assigned Guide:</strong> {{getAssignedGuide(fort.id)?.name}}<br>
            <small>ğŸ“ {{getAssignedGuide(fort.id)?.phone}} | â­ {{getAssignedGuide(fort.id)?.rating}}/5</small>
            <button class="btn btn-sm btn-outline-light ms-2" (click)="unassignGuide(getAssignedGuide(fort.id)!.id)">
              Unassign
            </button>
          </div>

          <!-- Map Section -->
          <div *ngIf="showMap[fort.id]" class="mt-3">
            <iframe [src]="getSafeMapUrl(fort.mapUrl)" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" class="rounded"></iframe>
          </div>

          <!-- Guide Assignment Section -->
          <div *ngIf="showGuideAssignment[fort.id]" class="mt-3 p-3 bg-dark rounded">
            <h5 class="text-warning">Available Guides</h5>
            <div *ngIf="availableGuides.length === 0" class="text-muted">
              No guides available at the moment.
            </div>
            <div *ngFor="let guide of availableGuides" class="border border-warning rounded p-2 mb-2">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{guide.name}}</strong> ({{guide.experience}} years)<br>
                  <small>{{guide.specialization.join(', ')}} | â­ {{guide.rating}}/5</small><br>
                  <small>ğŸ“ {{guide.phone}}</small>
                </div>
                <button class="btn btn-sm btn-warning" (click)="assignGuide(fort.id, guide.id)">
                  Assign
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6 text-center">
          <img [src]="fort.image" [alt]="fort.name" class="img-fluid rounded shadow-lg border border-3 border-warning">
        </div>
      </article>

    </main>
  </div>
</div>

<style>
  a { text-decoration: none; }
  a:hover { text-decoration: underline; }
  .story-block { 
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .story-block:hover {
    transform: translateY(-5px);
    box-shadow: 0px 8px 20px rgba(255, 215, 0, 0.3);
  }
</style>